# 🔒 セキュリティガイド

## ⚠️ 重要な注意事項

**APIキーは機密情報です。絶対に他人に公開しないでください！**

## 現在のセキュリティ対策

### ✅ 実装済みの対策

1. **環境変数の使用**
   - APIキーは `.env` ファイルに保存されています
   - コード内に直接APIキーを書き込んでいません

2. **.gitignore の設定**
   - `.env` ファイルはGitにコミットされません
   - 誤って公開されることを防ぎます

## 🔐 追加で推奨されるセキュリティ対策

### 1. Google Cloud ConsoleでAPIキーを制限する（重要！）

現在のAPIキーは制限なしの状態です。セキュリティのため、以下の制限を設定することを強く推奨します。

#### ステップ1: APIキーの制限ページに移動

1. https://console.cloud.google.com/ にアクセス
2. プロジェクトを選択
3. 「APIとサービス」→「認証情報」をクリック
4. 作成したAPIキーをクリック

#### ステップ2: アプリケーションの制限を設定

1. 「アプリケーションの制限」セクションで「HTTPリファラー（ウェブサイト）」を選択
2. 「ウェブサイトの制限」に以下を追加：
   ```
   http://localhost:*
   http://127.0.0.1:*
   ```
   - 本番環境の場合は、実際のドメインも追加：
   ```
   https://yourdomain.com/*
   https://www.yourdomain.com/*
   ```

#### ステップ3: APIの制限を設定

1. 「APIの制限」セクションで「特定のAPIに制限」を選択
2. 以下のAPIのみを選択：
   - Maps JavaScript API
   - Geocoding API
   - Directions API
3. 「保存」をクリック

### 2. 本番環境での追加対策

#### バックエンドプロキシの使用（推奨）

本番環境では、APIキーをフロントエンドに直接公開せず、バックエンドサーバーを経由させることを推奨します。

**理由：**
- フロントエンドのコードは誰でも見ることができる
- バックエンドでAPIキーを管理することで、より安全

**実装例：**
```typescript
// バックエンドAPIを経由してGoogle Maps APIを呼び出す
const response = await fetch('/api/maps/directions', {
  method: 'POST',
  body: JSON.stringify({ origin, destination })
});
```

### 3. 使用量の監視

1. Google Cloud Consoleで「APIとサービス」→「ダッシュボード」を確認
2. 異常な使用量がないか定期的にチェック
3. 使用量のアラートを設定することを推奨

### 4. 請求アラートの設定

1. Google Cloud Consoleで「課金」→「予算とアラート」を開く
2. 予算を設定（例：$10/月）
3. 予算の50%、90%、100%でアラートを設定

## 🚨 もしAPIキーが漏洩した場合

1. **すぐにAPIキーを無効化**
   - Google Cloud Consoleで「認証情報」→ APIキーを選択
   - 「無効にする」をクリック

2. **新しいAPIキーを作成**
   - 新しいAPIキーを作成
   - `.env` ファイルを更新
   - 開発サーバーを再起動

3. **使用量を確認**
   - 不正な使用がないか確認
   - 必要に応じてGoogleサポートに連絡

## 📋 チェックリスト

- [ ] `.env` ファイルが `.gitignore` に含まれている
- [ ] APIキーにアプリケーションの制限を設定した
- [ ] APIキーにAPIの制限を設定した
- [ ] 使用量の監視を設定した
- [ ] 請求アラートを設定した
- [ ] `.env` ファイルをGitにコミットしていない（確認済み）

## 💡 ベストプラクティス

1. **開発環境と本番環境で別のAPIキーを使用**
   - 開発用と本番用で分けることで、影響範囲を限定

2. **定期的なローテーション**
   - 定期的にAPIキーを更新（例：3-6ヶ月ごと）

3. **最小権限の原則**
   - 必要なAPIのみを有効化
   - 必要最小限の権限のみを付与

4. **コードレビュー**
   - コミット前にAPIキーが含まれていないか確認
   - `.env` ファイルが誤ってコミットされていないか確認

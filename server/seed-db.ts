/**
 * DB専用シードスクリプト（サーバー不要）
 * Docker起動時に自動実行される
 *
 * 実行方法: bun run seed-db.ts
 */

import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();
const ANONYMOUS_USER_ID = 'anonymous-user';

// 車関連のQ&Aデータ（20件）
const CAR_QA_DATA = [
  // === 位置情報関連 ===
  {
    question: '近くのトヨタディーラーを教えて',
    answer: `東京駅付近のトヨタディーラーをご紹介します。

1. **トヨタモビリティ東京 丸の内店**
   - 住所: 東京都千代田区丸の内1-9-2
   - 電話: 03-1234-5678
   - 営業時間: 10:00-19:00

2. **トヨタモビリティ東京 銀座店**
   - 住所: 東京都中央区銀座5-2-1
   - 電話: 03-2345-6789
   - 営業時間: 10:00-19:00

最寄りの店舗で試乗予約も可能です。`,
  },
  {
    question: '近くのホンダディーラーはどこ？',
    answer: `東京駅付近のホンダディーラーをご紹介します。

1. **Honda Cars 東京中央 日本橋店**
   - 住所: 東京都中央区日本橋3-5-12
   - 電話: 03-3456-7890
   - 営業時間: 10:00-19:00

2. **Honda Cars 東京中央 銀座店**
   - 住所: 東京都中央区銀座7-4-5
   - 電話: 03-4567-8901
   - 営業時間: 10:00-19:00

事前予約で待ち時間なしで対応してもらえます。`,
  },
  {
    question: '近くのガソリンスタンドを探して',
    answer: `東京駅付近のガソリンスタンドをご紹介します。

1. **ENEOS 丸の内SS**
   - 住所: 東京都千代田区丸の内2-1-1
   - 営業時間: 24時間
   - レギュラー: 168円/L、ハイオク: 179円/L

2. **出光 八重洲SS**
   - 住所: 東京都中央区八重洲1-3-7
   - 営業時間: 7:00-22:00
   - レギュラー: 166円/L、ハイオク: 177円/L

3. **コスモ石油 京橋SS**
   - 住所: 東京都中央区京橋2-4-16
   - 営業時間: 6:00-23:00

プリウスはレギュラーガソリンで大丈夫です。`,
  },
  {
    question: '近くのEV充電スポットはありますか？',
    answer: `東京駅付近のEV充電スポットをご紹介します。

1. **丸ビル地下駐車場（急速充電）**
   - 住所: 東京都千代田区丸の内2-4-1
   - 充電器: CHAdeMO 50kW
   - 料金: 30分 550円

2. **八重洲地下街駐車場（普通充電）**
   - 住所: 東京都中央区八重洲2丁目
   - 充電器: 普通充電 6kW
   - 料金: 1時間 330円

3. **日本橋三越駐車場（急速充電）**
   - 充電器: CHAdeMO 50kW
   - 料金: 30分 500円

充電中は施設内でお買い物も楽しめます。`,
  },
  {
    question: '近くの駐車場で安いところは？',
    answer: `東京駅付近の駐車場（料金が安い順）をご紹介します。

1. **タイムズ八重洲**
   - 料金: 15分 200円、最大料金 2,400円/日
   - 収容台数: 150台

2. **三井のリパーク 日本橋**
   - 料金: 20分 300円、最大料金 2,800円/日
   - 収容台数: 80台

3. **丸の内パークビル駐車場**
   - 料金: 30分 400円、最大料金 3,000円/日
   - 収容台数: 200台

週末は混雑するので、事前予約できるakippaやタイムズBの利用もおすすめです。`,
  },

  // === 車ブランド・燃費関連 ===
  {
    question: 'プリウスの燃費はどれくらい？',
    answer: `トヨタ プリウスの燃費情報です。

**現行モデル（5代目・2023年〜）**
- WLTCモード燃費: **32.6 km/L**（2.0Lハイブリッド）
- 市街地モード: 31.8 km/L
- 郊外モード: 36.3 km/L
- 高速道路モード: 30.7 km/L

**実燃費の目安**
- 街乗り中心: 25〜28 km/L
- 高速道路中心: 28〜32 km/L

エコドライブを心がけると、さらに燃費が向上します。`,
  },
  {
    question: 'ホンダ フィットの燃費を教えて',
    answer: `ホンダ フィットの燃費情報です。

**現行モデル（4代目・2020年〜）**

【e:HEV（ハイブリッド）】
- WLTCモード燃費: **29.4 km/L**
- 市街地モード: 30.2 km/L
- 郊外モード: 32.4 km/L
- 高速道路モード: 27.2 km/L

【ガソリン車】
- WLTCモード燃費: **20.4 km/L**

**実燃費の目安**
- ハイブリッド街乗り: 23〜26 km/L
- ガソリン街乗り: 16〜18 km/L

コンパクトながら室内空間が広く、燃費も優秀です。`,
  },
  {
    question: '日産リーフの航続距離は？',
    answer: `日産リーフの航続距離情報です。

**リーフ（40kWhバッテリー）**
- WLTCモード航続距離: **322 km**
- 実航続距離（目安）: 250〜280 km

**リーフe+（60kWhバッテリー）**
- WLTCモード航続距離: **450 km**
- 実航続距離（目安）: 350〜400 km

**航続距離に影響する要因**
- エアコン使用: -10〜20%
- 高速走行: -15〜25%
- 冬季（低温）: -20〜30%

急速充電（CHAdeMO）で約40分で80%まで充電できます。`,
  },
  {
    question: 'テスラ モデル3とリーフを比較して',
    answer: `テスラ モデル3と日産リーフの比較です。

| 項目 | テスラ モデル3 | 日産リーフe+ |
|------|--------------|-------------|
| 価格 | 536万円〜 | 583万円〜 |
| 航続距離 | 565km | 450km |
| 加速(0-100km) | 6.1秒 | 7.4秒 |
| 充電規格 | テスラ専用/CCS | CHAdeMO |
| 自動運転 | オートパイロット | プロパイロット |

**テスラの強み**: 航続距離、OTAアップデート、スーパーチャージャー網
**リーフの強み**: 国産の安心感、CHAdeMO普及率、価格（補助金込み）

用途や充電環境に合わせて選ぶのがおすすめです。`,
  },
  {
    question: 'マツダ CX-5の評価はどう？',
    answer: `マツダ CX-5の評価をまとめました。

**総合評価: ★★★★☆（4.2/5）**

【良い点】
- デザイン: 魂動デザインで高級感あり
- 走行性能: SKYACTIV技術で気持ちいい走り
- 内装品質: 価格以上の質感
- 静粛性: クラストップレベル

【気になる点】
- 燃費: ライバル比やや劣る（14.6km/L）
- 後席: やや狭め
- 先進装備: 一部グレードのみ

**おすすめグレード**
- コスパ重視: 20S（ガソリン）
- 走り重視: XD（ディーゼル）

ドライブ好きな方に特におすすめのSUVです。`,
  },

  // === 車の操作・機能関連 ===
  {
    question: 'ハイブリッド車のバッテリー寿命は？',
    answer: `ハイブリッド車のバッテリー寿命についてお答えします。

**一般的な寿命**
- 走行距離: 15〜20万km
- 年数: 10〜15年

**メーカー保証**
- トヨタ: 5年/10万km（新車保証延長で10年/20万km）
- ホンダ: 5年/10万km
- 日産: 5年/10万km

**バッテリー交換費用**
- プリウス: 約15〜20万円
- フィット: 約12〜18万円
- アクア: 約13〜17万円

最近のハイブリッドバッテリーは非常に耐久性が高く、通常の使用では寿命を心配する必要はほとんどありません。`,
  },
  {
    question: 'エンジンオイルの交換時期は？',
    answer: `エンジンオイルの交換時期の目安です。

**ガソリン車**
- 通常: 5,000km または 6ヶ月
- シビアコンディション: 2,500km または 3ヶ月

**ハイブリッド車**
- 通常: 10,000km または 1年
- シビアコンディション: 5,000km または 6ヶ月

**ディーゼル車**
- 通常: 5,000km または 6ヶ月

**シビアコンディションとは**
- 短距離走行が多い
- 渋滞が多い
- 山道・坂道が多い
- 寒冷地での使用

定期的な交換でエンジン寿命が大幅に延びます。`,
  },
  {
    question: 'スタッドレスタイヤはいつ履き替える？',
    answer: `スタッドレスタイヤの履き替え時期についてお答えします。

**冬タイヤへの履き替え（秋）**
- 目安: 最低気温が7℃を下回る頃
- 地域別目安:
  - 北海道: 10月下旬〜11月上旬
  - 東北: 11月中旬
  - 関東: 12月上旬
  - 関西: 12月中旬

**夏タイヤへの履き替え（春）**
- 目安: 最低気温が7℃を上回る頃
- 地域別目安:
  - 関東: 3月下旬〜4月上旬
  - 東北: 4月中旬
  - 北海道: 4月下旬〜5月上旬

**注意点**
- スタッドレスは夏に使うと摩耗が早い
- 製造から4年以上経過したタイヤは性能低下
- 溝の残りが50%以下なら交換推奨`,
  },
  {
    question: '車検の費用はどれくらい？',
    answer: `車検費用の目安をお伝えします。

**軽自動車**
- 法定費用: 約27,000円
- 整備費用: 20,000〜50,000円
- 合計: **約50,000〜80,000円**

**小型車（〜1.5L）**
- 法定費用: 約43,000円
- 整備費用: 30,000〜60,000円
- 合計: **約70,000〜100,000円**

**普通車（1.5L〜2.0L）**
- 法定費用: 約52,000円
- 整備費用: 40,000〜80,000円
- 合計: **約90,000〜130,000円**

**費用を抑えるコツ**
- ユーザー車検: 法定費用のみで済む
- 車検専門店: ディーラーより2〜3割安い
- 早期予約割引を活用

見積もりは複数社で比較するのがおすすめです。`,
  },

  // === 購入・比較関連 ===
  {
    question: 'SUVのおすすめは？',
    answer: `人気SUVのおすすめをご紹介します。

**コンパクトSUV（300万円以下）**
1. トヨタ ヤリスクロス - 燃費最強（30.8km/L）
2. ホンダ ヴェゼル - デザイン◎、室内広い
3. マツダ CX-30 - 走りの質感が高い

**ミドルサイズSUV（300〜500万円）**
1. トヨタ RAV4 - 走破性能◎、リセール良好
2. マツダ CX-5 - 内装の質感、走り
3. スバル フォレスター - AWD性能、安全性

**高級SUV（500万円以上）**
1. トヨタ ハリアー - 高級感、乗り心地
2. レクサス NX - プレミアム、先進装備
3. マツダ CX-60 - 直6ディーゼル、上質な走り

用途と予算に合わせてお選びください。`,
  },
  {
    question: '軽自動車で燃費がいいのは？',
    answer: `燃費の良い軽自動車ランキングです。

**燃費トップ5（WLTCモード）**

1. **スズキ アルト** - 27.7km/L
   - 価格: 94万円〜
   - 特徴: 軽量ボディ、シンプル設計

2. **ダイハツ ミライース** - 25.0km/L
   - 価格: 86万円〜
   - 特徴: 低価格、ビジネス用途にも

3. **スズキ ワゴンRスマイル** - 25.1km/L
   - 価格: 129万円〜
   - 特徴: スライドドア、ファミリー向け

4. **ホンダ N-WGN** - 23.2km/L
   - 価格: 129万円〜
   - 特徴: 安全性能、室内の広さ

5. **ダイハツ タント** - 22.7km/L
   - 価格: 135万円〜
   - 特徴: 大開口ドア、子育て世代に人気

実燃費は+3〜5km/L悪くなる傾向があります。`,
  },
  {
    question: '新車と中古車どっちがお得？',
    answer: `新車と中古車の比較をお伝えします。

**新車のメリット**
- 最新の安全装備・燃費性能
- メーカー保証あり（3〜5年）
- 好きな色・オプションを選べる
- ローン金利が低い（1〜3%）

**中古車のメリット**
- 購入価格が安い（新車の50〜70%）
- 納車が早い
- 登録諸費用が安い
- 値落ちが少ない

**お得な選び方**

| 条件 | おすすめ |
|------|---------|
| 5年以上乗る | 新車 |
| 3年程度で乗り換え | 中古車（高年式） |
| 初めての車 | 中古車で慣れる |
| 最新機能重視 | 新車 |
| コスト重視 | 中古車 |

**狙い目の中古車**
- 3年落ち（初回車検後）
- 走行3万km以下
- ディーラー認定中古車`,
  },
  {
    question: '自動車保険の相場は？',
    answer: `自動車保険の相場をお伝えします。

**年齢別の相場（年間保険料）**

| 年齢 | 6等級 | 12等級 | 20等級 |
|------|-------|--------|--------|
| 20代 | 15〜25万円 | 10〜15万円 | 8〜12万円 |
| 30代 | 8〜15万円 | 5〜10万円 | 4〜7万円 |
| 40代 | 6〜12万円 | 4〜8万円 | 3〜6万円 |
| 50代〜 | 5〜10万円 | 3〜7万円 | 2〜5万円 |

**保険料を安くするコツ**
1. ネット型保険を選ぶ（代理店型より20〜30%安い）
2. 年払いにする（月払いより5%程度安い）
3. 走行距離を正確に申告
4. 運転者を限定する
5. 車両保険の免責金額を上げる

おすすめのネット型保険: ソニー損保、SBI損保、チューリッヒなど`,
  },
  {
    question: '車のサブスクってお得なの？',
    answer: `車のサブスク（カーリース）についてお答えします。

**主なサービス**
- KINTO（トヨタ）
- 定額カルモくん
- SOMPOで乗ーる
- コスモMyカーリース

**月額料金の目安**
- 軽自動車: 15,000〜25,000円/月
- コンパクトカー: 25,000〜40,000円/月
- SUV・ミニバン: 40,000〜60,000円/月

**メリット**
- 頭金不要
- 税金・車検・メンテ込み
- 毎月定額で管理しやすい

**デメリット**
- 走行距離制限あり（月1,000〜1,500km）
- 途中解約に違約金
- カスタマイズ不可
- 長期では購入より割高

**おすすめな人**
- 初期費用を抑えたい
- 3〜5年で乗り換えたい
- 車の管理が面倒な人`,
  },
  {
    question: '電気自動車の充電代はいくら？',
    answer: `電気自動車の充電コストをお伝えします。

**自宅充電（深夜電力利用）**
- 電気代: 約3〜4円/km
- 月1,000km走行で: 約3,000〜4,000円
- ガソリン車比: 約1/3〜1/4のコスト

**公共充電スポット**
- 急速充電: 15〜20円/分（30分で450〜600円）
- 普通充電: 無料〜3円/分
- 充電カード（月額）: 4,000〜5,000円で急速充電し放題も

**月間コスト比較（1,000km走行）**
| 車種 | 月間燃料代 |
|------|-----------|
| ガソリン車（15km/L） | 約11,000円 |
| ハイブリッド（25km/L） | 約6,600円 |
| 電気自動車（自宅充電） | 約3,500円 |

**注意点**
- 冬季は暖房で電費悪化（+20〜30%）
- 高速走行は電費悪化
- 自宅充電設備の設置費用: 5〜15万円`,
  },
];

async function checkExistingSeed(): Promise<boolean> {
  // 既にシードデータがあるかチェック
  const existingConversations = await prisma.conversation.findMany({
    where: {
      userId: ANONYMOUS_USER_ID,
      title: {
        in: CAR_QA_DATA.map(qa => qa.question.slice(0, 50)),
      },
    },
    take: 1,
  });
  return existingConversations.length > 0;
}

async function seedDatabase() {
  console.log('='.repeat(60));
  console.log('車関連の共有ナレッジをDBに登録します');
  console.log('='.repeat(60));

  // 既存データチェック
  const alreadySeeded = await checkExistingSeed();
  if (alreadySeeded) {
    console.log('\n✅ シードデータは既に登録されています。スキップします。');
    await prisma.$disconnect();
    return;
  }

  let successCount = 0;
  let errorCount = 0;

  for (let i = 0; i < CAR_QA_DATA.length; i++) {
    const qa = CAR_QA_DATA[i];
    console.log(`\n[${i + 1}/${CAR_QA_DATA.length}] 登録中: "${qa.question.slice(0, 30)}..."`);

    try {
      // 1. 会話をDBに作成
      const conversation = await prisma.conversation.create({
        data: {
          userId: ANONYMOUS_USER_ID,
          title: qa.question.slice(0, 50),
        },
      });

      // 2. ユーザーメッセージを保存
      await prisma.message.create({
        data: {
          conversationId: conversation.id,
          role: 'user',
          content: qa.question,
        },
      });

      // 3. アシスタントメッセージを保存
      await prisma.message.create({
        data: {
          conversationId: conversation.id,
          role: 'assistant',
          content: qa.answer,
        },
      });

      successCount++;
      console.log(`   ✅ 登録完了 (ID: ${conversation.id})`);

    } catch (error) {
      errorCount++;
      console.log(`   ❌ エラー: ${error}`);
    }
  }

  await prisma.$disconnect();

  console.log('\n' + '='.repeat(60));
  console.log('シード完了');
  console.log('='.repeat(60));
  console.log(`成功: ${successCount}件`);
  console.log(`失敗: ${errorCount}件`);
}

seedDatabase().catch(console.error);
